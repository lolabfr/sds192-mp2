---
title: "Mini-Project 2"
author: "Beth Campbell, Lola Roberts and Felicia Villalobos"
date: "March 22, 2018"
output:
  html_document:
    code_folding: hide
    
---

For this project, we analyzed the FEC data files for the 2011-2012 election cycle. We used information about the candidates, contributions, house elections, and committees to create a visualization about how much money was spent on candidates overall during this cycle. We then use another graphic to visualize where that money came from, an organization affiliated with the democratic party, the republican party, or other (another party or an organization not associated with a party). For these visualizations, we have used the ten candidates that have had the most money spent on them in the House elections during this cycle.

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(ggplot2)
library(gridExtra)
```

```{r, message=FALSE, warning=FALSE}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```

The first graphic shows the total contributions (in millions of dollars) that a candidate received and also shows the state where the candidate is from. We found the total amount of money spent on each candidate by joining together the candidates dataset and contributions dataset (full_join).

This data may be misleading because we have summed all of the money spent candidates without a distinction of whether the contribution was used for or against them. 

Before joining we selected columns from each dataset with relevant information and to speed up the joining process as to not overload the RStudio system. Once we joined them, we filtered out all of the information with NA to make our dataset more clear and easier to understand. From there we grouped by candidate name and state so that we could see the total amount they received. In order to see the candidate that received the largest total amount of contributions at the top of the dataframe, we arranged it in descending order. We chose to only show the top ten candidates in order to make our graph more digestible and less overwhelming. From this data we can see which candidate got the most contributions and which state that candidate came from during the 2011-2012 election cycle. 

```{r, message=FALSE, warning=FALSE}
# what we want from candidates
# candFilter <- candidates %>%
#   select(cand_id, cand_name, cand_party_affiliation, cand_state)

# what we want from candidates
candidateSelection <- candidates %>%
  select(cand_id, cand_name, cand_party_affiliation, cand_state)

# what we want from house_elections
houseElection <- house_elections %>%
  select(fec_id, state, candidate_name, general_votes, ge_winner)

# what we want from contributions
contrFilter <- contributions %>%
  select(cmte_id, name, state, transaction_amt, cand_id)

# what we want from committees
committeeFilter <- committees %>%
  select(cmte_id, cmte_name, cmte_party_affiliation, cmte_type, org_type)

#joining the data set of committe to contributions
committeContribution <- contrFilter %>%
  full_join(committeeFilter, contrFilter, by = "cmte_id")

# joining the data set of candidate and house election 
houseCandid <- houseElection %>%
  full_join(candidateSelection, houseElection, by = c("fec_id" = "cand_id"))

# joing the previous joined data set with contributions and editing the data set to show what we want
houseCandContrib <- houseCandid %>%
  inner_join(committeContribution, houseCandid, by = c("fec_id" = "cand_id")) %>%
  filter(!is.na(cand_name),
         !is.na(cmte_id),
         !is.na(name),
         !is.na(transaction_amt),
         !is.na(general_votes),
         transaction_amt > 0) %>%
  mutate(ge_winner = ifelse(ge_winner == "W", 1, 0),
         contrParty = ifelse(cmte_party_affiliation == "REP", 1,
                            ifelse(cmte_party_affiliation == "DEM", 1, 1)),
         candParty = ifelse(cand_party_affiliation == "REP", 1,
                            ifelse(cand_party_affiliation == "DEM", 1000, 0))) %>%
  group_by(cand_name, cand_state) %>%
  summarize(totalContributionCandidate = sum(transaction_amt),
            general_votes = sum(general_votes),
            ge_winner = sum(ge_winner),
            contributionParty = sum(contrParty),
            candidateParty = sum(candParty)) %>%
  mutate(ge_winner = ifelse(ge_winner > 1, "Win", "Lose"),
         candidateParty = ifelse(candidateParty > 2000, "Dem", "Rep")) %>%
  arrange(desc(totalContributionCandidate)) %>%
  head(10)
```

```{r}
# writing a function for the graphs, so we don't have the same code repeated
graph <- function(dataSet, xElement, yElement, fillElement, yAxisLab) {
  ggplot(dataSet, aes(x = xElement, y = yElement, fill = fillElement)) + 
    geom_bar(stat = "identity") + 
    theme(axis.text.x = element_text(size = rel(0.7), angle = 70, hjust = 1)) +
    xlab("Candidates") + 
    ylab(yAxisLab)
}
```


```{r, message=FALSE, warning=FALSE}
#graphic showing candidate vs. total contribution
candVs.Money <- graph(houseCandContrib, houseCandContrib$cand_name, houseCandContrib$totalContributionCandidate,
                      houseCandContrib$cand_state, "Total Contribution\n(Millions)") + 
  scale_y_continuous(breaks = c(0e+00, 2e+06, 4e+06, 6e+06),
                     labels = c(0, 2, 4, 6)) +
  ggtitle("Candidates vs. Total Contribution")

candVs.Money
```

This data graphic would be a good comparison to the last one in order to see how many votes each candidate got in comparison to the amount of money was spent on them. This data is for the same 10 candidates as in the previous graphic. These two data graphics are meant to help us try to find a possible correlation between the amount of money contributed to campaign (either for it or against it) and its effect on the number of general votes. For example, if a candidate has had more money spent on them but, fewer general votes, then maybe we can infer that the money spent was used against their campaign (ex. For a negative ad against a candidate that, in turn, influenced voters).   

```{r, message=FALSE, warning=FALSE}
candVs.Vote <- graph(houseCandContrib, houseCandContrib$cand_name, houseCandContrib$general_votes, houseCandContrib$ge_winner, "General Votes\n(Hundreds of Millions)") +
  scale_y_continuous(breaks = c(0e+00, 1e+08, 2e+08, 3e+08),
                     labels = c(0, 1, 2, 3)) +
  ggtitle("Candidates vs. General Votes")

candVs.Vote
```

Our third graphic displays the total number of contributions that the same top ten candidates received. In the graphic we separate the number of contributions that each candidate received by where the contribution came from as described above. We also separated the candidates by which party they are affiliated with in order to see if there’s a correlation between how many contributions they received, where those contributions came from, and what party the candidate is affiliated with. From this data graphic, we can see that the majority of the contributions a candidate receives is not affiliated with a major party and that a candidate receives more contributions from the party it’s affiliated with than the opposing party.

```{r, message=FALSE, warning=FALSE}
# candVs.Contribution <- graph(houseCandContrib$contributionParty, houseCandContrib$candidateParty, "Total Number of Contributions")
# 
# candVs.Contribution

Democratic = c(15, 30, 22, 10, 96, 65, 15, 15, 30, 91)

Republican = c(62, 76, 80, 66, 25, 6, 77, 73, 67, 10)

Other = c(923, 821, 842, 631, 1801, 426, 861, 1043, 664, 666)

candidateName = c("Biggert, Judy", "Bilbray, Brian Phillip", "Canseco, Francisco Raul Quico R.", "Cravaack, Raymond J Mr.", "Critz, Mark", "Duckworth, L. Tammy", " Lungren, Daniel E.", "Renacci, James B.", "Schilling, Robert T.", "Shutton, Betty S.")

candidateParty = c("R", "R", "R", "R", "D", "D", "R", "R", "R", "D" )

candParty <- houseCandContrib %>%
  select(candidateParty)

party = data_frame(Democratic, Republican, Other, candidateName, candidateParty)

canDemParty <- party %>%
  gather(party, numberOfContributions, -candidateName, -candidateParty) %>%
  filter(candidateParty == "D")

# creating the bar graph for candidates vs. the party they recieved money from

candDemVs.Contribution <- graph(canDemParty, canDemParty$candidateName, canDemParty$numberOfContributions, canDemParty$party, "Number of Contributions") + 
  ggtitle("Democatic Candidate vs.\n Number of Contributions By Party") + 
  scale_fill_manual(values=c(Democratic="blue", Republican="red", Other = "grey")) + 
  theme(legend.position="none")

# candDemVs.Contribution


canRepParty <- party %>%
  gather(party, numberOfContributions, -candidateName, -candidateParty) %>%
  filter(candidateParty == "R")

candRepVs.Contribution <- graph(canRepParty, canRepParty$candidateName, canRepParty$numberOfContributions, canRepParty$party, "") + 
  ggtitle("Republican Candidate vs.\n Number of Contributions By Party") + 
  scale_fill_manual(values=c(Democratic="blue", Republican="red", Other = "grey")) + 
  scale_y_continuous(breaks = c(0, 500, 1000, 1500, 2000))

# candRepVs.Contribution

grid.arrange(
  arrangeGrob(
  candDemVs.Contribution,
  candRepVs.Contribution,
  nrow = 1,
  ncol = 2
))
```
^[https://github.com/lolabfr/sds192-mp2.git]
